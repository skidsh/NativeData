<style>
  .color-scheme-toggle {
    position: fixed;
    top: 0.75rem;
    right: 1rem;
    z-index: 1000;
    background: transparent;
    border: 1px solid var(--border-color, #ccc);
    border-radius: 0.375rem;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    font-size: 1rem;
    line-height: 1.5;
    opacity: 0.8;
    transition: opacity 0.2s;
  }
  .color-scheme-toggle:hover {
    opacity: 1;
  }
</style>
<script>
  (function () {
    var STORAGE_KEY = 'jtd-color-scheme';
    var MAX_RETRIES = 40;
    var retries = 0;

    function applyAndCreateToggle() {
      if (typeof jtd === 'undefined' || !document.body) {
        if (retries < MAX_RETRIES) {
          retries++;
          setTimeout(applyAndCreateToggle, 50);
        }
        return;
      }

      var saved = localStorage.getItem(STORAGE_KEY) || 'dark';
      jtd.setTheme(saved);

      var btn = document.createElement('button');
      btn.className = 'color-scheme-toggle';

      function updateBtn(scheme) {
        btn.textContent = scheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        btn.title = scheme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode';
        btn.setAttribute('aria-label', btn.title);
      }

      updateBtn(saved);

      btn.addEventListener('click', function () {
        var next = jtd.getTheme() === 'dark' ? 'light' : 'dark';
        jtd.setTheme(next);
        localStorage.setItem(STORAGE_KEY, next);
        updateBtn(next);
      });

      document.body.appendChild(btn);
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', applyAndCreateToggle);
    } else {
      applyAndCreateToggle();
    }
  })();
</script>
